{"version":3,"sources":["webpack:///./src/views/Roles/CreateRole.vue","webpack:///./src/views/Roles/CreateRole.vue?9fd0"],"names":["class","for","type","placeholder","style","to","active","isLoading","is-full-page","fullPage","state","createRole","disabled","value","id","roleData","cht_name","name","rows","description","updateRole","rangeList","range","index","key","checked","sub_ranges","every","ele","roleHasRanges","includes","CheckAllRoles","sub","components","Loading","setup","proxy","route","router","mixinPostMsg","postToasts","ranges","getRanges","axios","get","then","response","data","e","tempRange","filter","target","forEach","some","concat","post","res","message","setTimeout","push","catch","error","updateUrl","updateData","put","resData","role","params","roleSettings","JSON","parse","render"],"mappings":"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","file":"js/chunk-2d0e28d2.57254578.js","sourcesContent":["<template>\n  <div class=\"about px-4 mt-4\">\n    <router-link to=\"/admin/permission/roles\">\n      <p><span class=\"material-icons align-bottom\">arrow_back</span>返回</p>\n    </router-link>\n    <div class=\"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative\">\n      <loading :active=\"isLoading\" :is-full-page=\"fullPage\"></loading>\n      <div class=\"card-header bg-white d-flex justify-content-between align-items-center py-3\">\n        <h5 class=\"mb-0\">{{ state == 'create'? '新增角色' : '編輯角色'}}</h5>\n        <button v-if=\"state == 'create'\" class=\"btn btn-primary\"\n        @click=\"createRole\" :disabled=\"isLoading.value\">建立</button>\n      </div>\n      <div class=\"card-body px-4\">\n        <p class=\"text-muted\"><small>\n          <span class=\"material-icons small align-middle\"> info </span>\n          權限角色的名稱，不能有空格，僅接受符號 - _，最短 1 個，最長 50 個字\n        </small></p>\n        <div class=\"mb-3\">\n          <label for=\"r_cht_name\" class=\"form-label\">角色中文名稱</label>\n          <input type=\"text\" class=\"form-control\" id=\"r_cht_name\" v-model=\"roleData.cht_name\">\n        </div>\n        <div class=\"mb-3\">\n          <label for=\"r_name\" class=\"form-label\">角色名稱</label>\n          <input type=\"text\" class=\"form-control\" id=\"r_name\"\n          v-model=\"roleData.name\" placeholder=\"student\">\n        </div>\n        <div class=\"mb-3\">\n          <label for=\"r_description\" class=\"form-label\">描述 </label>\n          <textarea class=\"form-control\" id=\"r_description\" rows=\"3\"\n          v-model=\"roleData.description\"></textarea>\n        </div>\n        <div v-if=\"state === 'edit'\" class=\"d-flex justify-content-end\">\n          <button class=\"btn btn-primary\" @click=\"updateRole('roles')\"\n          :disabled=\"isLoading.value\">更新角色資料</button>\n        </div>\n        <hr />\n        <div class=\"mb-3\">\n          <p class=\"mb-2\">單一設置 <span class=\"small text-muted\">勾選為允許選項</span></p>\n           <div class=\"card-body bg-light rounded\">\n              <input class=\"form-control form-control-sm\" type=\"text\"\n              placeholder=\"搜尋\">\n              <ul class=\"list-unstyled mt-4 overflow-y-auto\"\n                style=\"max-height: 350px;\">\n                <li v-for=\"(range, index) in rangeList\"\n                  :key=\"'range' + index\">\n                  <div class=\"form-check\">\n                    <input class=\"form-check-input\" type=\"checkbox\"\n                    :id=\"range.name\"\n                    :checked=\"range.sub_ranges.every(ele => roleHasRanges.includes(ele.id))\"\n                    @change=\"CheckAllRoles\">\n                    <label class=\"form-check-label\" :for=\"range.name\">\n                      {{ range.cht_name }}\n                    </label>\n                  </div>\n                  <ul class=\"list-unstyled ms-4\">\n                    <li>\n                      <div class=\"form-check\"\n                      v-for=\"(sub, index) in range.sub_ranges\"\n                      :key=\"'sub' + sub.id + index\">\n                        <input class=\"form-check-input\" type=\"checkbox\"\n                        :id=\"'sub' + sub.id\"\n                        :value=\"sub.id\"\n                        v-model=\"roleHasRanges\">\n                        <label class=\"form-check-label\" :for=\"'sub' + sub.id\">\n                          {{ sub.cht_name }}\n                        </label>\n                      </div>\n                    </li>\n                  </ul>\n                </li>\n              </ul>\n            <div v-if=\"state === 'edit'\" class=\"d-flex justify-content-end\">\n              <button class=\"btn btn-primary\" @click=\"updateRole('ranges')\"\n              :disabled=\"isLoading.value\">更新角色權限</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  onMounted, ref, reactive, toRefs, getCurrentInstance,\n} from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport Loading from 'vue3-loading-overlay';\nimport 'vue3-loading-overlay/dist/vue3-loading-overlay.css';\nimport mixinPostMsg from '@/service/mixinPostMsg';\n\nexport default {\n  name: 'CreateRoles',\n  components: {\n    Loading,\n  },\n  setup() {\n    const { proxy } = getCurrentInstance();\n    const route = useRoute();\n    const router = useRouter();\n    const { postToasts } = mixinPostMsg(); // 發送訊息\n    const state = ref('create');\n    const isLoading = ref(false);\n    const fullPage = ref(false);\n    const roleData = reactive({\n      id: '',\n      cht_name: '',\n      description: '',\n      ranges: [],\n    });\n\n    const ranges = reactive({\n      rangeList: [],\n      roleHasRanges: [],\n    });\n    function getRanges() {\n      isLoading.value = true;\n      proxy.axios\n        .get('/v1/permission/ranges')\n        .then((response) => {\n          ranges.rangeList = response.data.ranges;\n          isLoading.value = false;\n        });\n    }\n    onMounted(\n      () => {\n        if (route.name === 'CreateRole') {\n          state.value = 'create';\n          getRanges();\n        } else if (route.name === 'EditRole' && route.params.roleSettings) {\n          state.value = 'edit';\n          getRanges();\n          const data = JSON.parse(route.params.roleSettings);\n          roleData.id = data.id;\n          roleData.name = data.name;\n          roleData.cht_name = data.cht_name;\n          roleData.description = data.description;\n          ranges.roleHasRanges = [];\n          data.ranges.forEach((range) => {\n            range.sub_ranges.forEach((sub) => {\n              ranges.roleHasRanges.push(sub.id);\n            });\n          });\n        } else {\n          router.push('/admin/permission/roles');\n        }\n      },\n    );\n    // checkbox 切換權限\n    function CheckAllRoles(e) {\n      const tempRange = ranges.rangeList.filter((range) => range.name === e.target.id);\n      if (e.target.checked) {\n        tempRange[0].sub_ranges.forEach((sub) => {\n          if (!ranges.roleHasRanges.some(\n            (range) => range === sub.id,\n          )) {\n            ranges.roleHasRanges = ranges.roleHasRanges.concat([sub.id]);\n          }\n        });\n      } else {\n        tempRange[0].sub_ranges.forEach((sub) => {\n          ranges.roleHasRanges = ranges.roleHasRanges.filter((range) => range !== sub.id);\n        });\n      }\n    }\n    // 修改 Role\n    function createRole() {\n      isLoading.value = true;\n      delete roleData.id;\n      roleData.ranges = ranges.roleHasRanges;\n      proxy.axios.post('/v1/permission/role', roleData).then((res) => {\n        if (res.data.message === '成功') {\n          postToasts('success', '建立角色權限成功，3 秒後跳轉回列表', '建立角色權限成功');\n          setTimeout(() => {\n            router.push('/admin/permission/roles');\n          }, 3000);\n        } else {\n          postToasts('success', '建立角色權限失敗', res.data.message);\n        }\n        isLoading.value = false;\n      }).catch((error) => {\n        postToasts('success', '建立角色權限失敗', error.response.data.message);\n        isLoading.value = false;\n      });\n    }\n    function updateRole(type) {\n      isLoading.value = true;\n      let updateUrl = '';\n      let updateData = {};\n      if (type === 'roles') {\n        updateUrl = `v1/permission/role/${roleData.id}`;\n        updateData = {\n          name: roleData.name,\n          cht_name: roleData.cht_name,\n          description: roleData.description,\n        };\n      } else if (type === 'ranges') {\n        updateUrl = ` /v1/permission/role/${roleData.id}/ranges`;\n        updateData = {\n          ranges: ranges.roleHasRanges,\n        };\n      }\n      proxy.axios.put(updateUrl, updateData).then((res) => {\n        if (res.data.message === '成功') {\n          const resData = res.data.role;\n          roleData.id = resData.id;\n          roleData.name = resData.name;\n          roleData.cht_name = resData.cht_name;\n          roleData.description = resData.description;\n          if (type === 'ranges') {\n            ranges.roleHasRanges = [];\n            resData.ranges.forEach((range) => {\n              range.sub_ranges.forEach((sub) => {\n                ranges.roleHasRanges.push(sub.id);\n              });\n            });\n          }\n          postToasts('success', '更新角色權限成功', `${type} 已經更新成功`);\n        } else {\n          postToasts('success', '更新角色權限失敗', res.data.message);\n        }\n        isLoading.value = false;\n      }).catch((error) => {\n        postToasts('success', '更新角色權限失敗', error.response.data.message);\n        isLoading.value = false;\n      });\n    }\n\n    return {\n      state,\n      roleData,\n      fullPage,\n      isLoading,\n      ...toRefs(ranges),\n      CheckAllRoles,\n      createRole,\n      updateRole,\n    };\n  },\n};\n</script>\n","import { render } from \"./CreateRole.vue?vue&type=template&id=55f8331a\"\nimport script from \"./CreateRole.vue?vue&type=script&lang=js\"\nexport * from \"./CreateRole.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}