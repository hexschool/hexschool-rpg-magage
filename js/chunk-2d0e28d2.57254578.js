(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e28d2"],{"7ed2":function(e,t,a){"use strict";a.r(t);a("b0c0"),a("a4d3"),a("e01a"),a("caad"),a("2532");var c=a("7a23"),n={class:"about px-4 mt-4"},s=Object(c["i"])("p",null,[Object(c["i"])("span",{class:"material-icons align-bottom"},"arrow_back"),Object(c["h"])("返回")],-1),i={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},l={class:"card-header bg-white d-flex justify-content-between align-items-center py-3"},o={class:"mb-0"},r={class:"card-body px-4"},u=Object(c["i"])("p",{class:"text-muted"},[Object(c["i"])("small",null,[Object(c["i"])("span",{class:"material-icons small align-middle"}," info "),Object(c["h"])(" 權限角色的名稱，不能有空格，僅接受符號 - _，最短 1 個，最長 50 個字 ")])],-1),d={class:"mb-3"},b=Object(c["i"])("label",{for:"r_cht_name",class:"form-label"},"角色中文名稱",-1),m={class:"mb-3"},O=Object(c["i"])("label",{for:"r_name",class:"form-label"},"角色名稱",-1),f={class:"mb-3"},j=Object(c["i"])("label",{for:"r_description",class:"form-label"},"描述 ",-1),p={key:0,class:"d-flex justify-content-end"},g=Object(c["i"])("hr",null,null,-1),h={class:"mb-3"},v=Object(c["i"])("p",{class:"mb-2"},[Object(c["h"])("單一設置 "),Object(c["i"])("span",{class:"small text-muted"},"勾選為允許選項")],-1),k={class:"card-body bg-light rounded"},_=Object(c["i"])("input",{class:"form-control form-control-sm",type:"text",placeholder:"搜尋"},null,-1),y={class:"list-unstyled mt-4 overflow-y-auto",style:{"max-height":"350px"}},R={class:"form-check"},x={class:"list-unstyled ms-4"},w={key:0,class:"d-flex justify-content-end"};function H(e,t,a,H,E,L){var C=Object(c["B"])("router-link"),D=Object(c["B"])("loading");return Object(c["u"])(),Object(c["e"])("div",n,[Object(c["i"])(C,{to:"/admin/permission/roles"},{default:Object(c["N"])((function(){return[s]})),_:1}),Object(c["i"])("div",i,[Object(c["i"])(D,{active:H.isLoading,"is-full-page":H.fullPage},null,8,["active","is-full-page"]),Object(c["i"])("div",l,[Object(c["i"])("h5",o,Object(c["E"])("create"==H.state?"新增角色":"編輯角色"),1),"create"==H.state?(Object(c["u"])(),Object(c["e"])("button",{key:0,class:"btn btn-primary",onClick:t[1]||(t[1]=function(){return H.createRole&&H.createRole.apply(H,arguments)}),disabled:H.isLoading.value},"建立",8,["disabled"])):Object(c["f"])("",!0)]),Object(c["i"])("div",r,[u,Object(c["i"])("div",d,[b,Object(c["O"])(Object(c["i"])("input",{type:"text",class:"form-control",id:"r_cht_name","onUpdate:modelValue":t[2]||(t[2]=function(e){return H.roleData.cht_name=e})},null,512),[[c["J"],H.roleData.cht_name]])]),Object(c["i"])("div",m,[O,Object(c["O"])(Object(c["i"])("input",{type:"text",class:"form-control",id:"r_name","onUpdate:modelValue":t[3]||(t[3]=function(e){return H.roleData.name=e}),placeholder:"student"},null,512),[[c["J"],H.roleData.name]])]),Object(c["i"])("div",f,[j,Object(c["O"])(Object(c["i"])("textarea",{class:"form-control",id:"r_description",rows:"3","onUpdate:modelValue":t[4]||(t[4]=function(e){return H.roleData.description=e})},null,512),[[c["J"],H.roleData.description]])]),"edit"===H.state?(Object(c["u"])(),Object(c["e"])("div",p,[Object(c["i"])("button",{class:"btn btn-primary",onClick:t[5]||(t[5]=function(e){return H.updateRole("roles")}),disabled:H.isLoading.value},"更新角色資料",8,["disabled"])])):Object(c["f"])("",!0),g,Object(c["i"])("div",h,[v,Object(c["i"])("div",k,[_,Object(c["i"])("ul",y,[(Object(c["u"])(!0),Object(c["e"])(c["a"],null,Object(c["z"])(e.rangeList,(function(a,n){return Object(c["u"])(),Object(c["e"])("li",{key:"range"+n},[Object(c["i"])("div",R,[Object(c["i"])("input",{class:"form-check-input",type:"checkbox",id:a.name,checked:a.sub_ranges.every((function(t){return e.roleHasRanges.includes(t.id)})),onChange:t[6]||(t[6]=function(){return H.CheckAllRoles&&H.CheckAllRoles.apply(H,arguments)})},null,40,["id","checked"]),Object(c["i"])("label",{class:"form-check-label",for:a.name},Object(c["E"])(a.cht_name),9,["for"])]),Object(c["i"])("ul",x,[Object(c["i"])("li",null,[(Object(c["u"])(!0),Object(c["e"])(c["a"],null,Object(c["z"])(a.sub_ranges,(function(a,n){return Object(c["u"])(),Object(c["e"])("div",{class:"form-check",key:"sub"+a.id+n},[Object(c["O"])(Object(c["i"])("input",{class:"form-check-input",type:"checkbox",id:"sub"+a.id,value:a.id,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.roleHasRanges=t})},null,8,["id","value"]),[[c["I"],e.roleHasRanges]]),Object(c["i"])("label",{class:"form-check-label",for:"sub"+a.id},Object(c["E"])(a.cht_name),9,["for"])])})),128))])])])})),128))]),"edit"===H.state?(Object(c["u"])(),Object(c["e"])("div",w,[Object(c["i"])("button",{class:"btn btn-primary",onClick:t[8]||(t[8]=function(e){return H.updateRole("ranges")}),disabled:H.isLoading.value},"更新角色權限",8,["disabled"])])):Object(c["f"])("",!0)])])])])])}var E=a("5530"),L=(a("159b"),a("4de4"),a("99af"),a("6c02")),C=a("8a14"),D=(a("fe26"),a("c85d")),J={name:"CreateRoles",components:{Loading:C["a"]},setup:function(){var e=Object(c["k"])(),t=e.proxy,a=Object(L["c"])(),n=Object(L["d"])(),s=Object(D["a"])(),i=s.postToasts,l=Object(c["x"])("create"),o=Object(c["x"])(!1),r=Object(c["x"])(!1),u=Object(c["w"])({id:"",cht_name:"",description:"",ranges:[]}),d=Object(c["w"])({rangeList:[],roleHasRanges:[]});function b(){o.value=!0,t.axios.get("/v1/permission/ranges").then((function(e){d.rangeList=e.data.ranges,o.value=!1}))}function m(e){var t=d.rangeList.filter((function(t){return t.name===e.target.id}));e.target.checked?t[0].sub_ranges.forEach((function(e){d.roleHasRanges.some((function(t){return t===e.id}))||(d.roleHasRanges=d.roleHasRanges.concat([e.id]))})):t[0].sub_ranges.forEach((function(e){d.roleHasRanges=d.roleHasRanges.filter((function(t){return t!==e.id}))}))}function O(){o.value=!0,delete u.id,u.ranges=d.roleHasRanges,t.axios.post("/v1/permission/role",u).then((function(e){"成功"===e.data.message?(i("success","建立角色權限成功，3 秒後跳轉回列表","建立角色權限成功"),setTimeout((function(){n.push("/admin/permission/roles")}),3e3)):i("success","建立角色權限失敗",e.data.message),o.value=!1})).catch((function(e){i("success","建立角色權限失敗",e.response.data.message),o.value=!1}))}function f(e){o.value=!0;var a="",c={};"roles"===e?(a="v1/permission/role/".concat(u.id),c={name:u.name,cht_name:u.cht_name,description:u.description}):"ranges"===e&&(a=" /v1/permission/role/".concat(u.id,"/ranges"),c={ranges:d.roleHasRanges}),t.axios.put(a,c).then((function(t){if("成功"===t.data.message){var a=t.data.role;u.id=a.id,u.name=a.name,u.cht_name=a.cht_name,u.description=a.description,"ranges"===e&&(d.roleHasRanges=[],a.ranges.forEach((function(e){e.sub_ranges.forEach((function(e){d.roleHasRanges.push(e.id)}))}))),i("success","更新角色權限成功","".concat(e," 已經更新成功"))}else i("success","更新角色權限失敗",t.data.message);o.value=!1})).catch((function(e){i("success","更新角色權限失敗",e.response.data.message),o.value=!1}))}return Object(c["s"])((function(){if("CreateRole"===a.name)l.value="create",b();else if("EditRole"===a.name&&a.params.roleSettings){l.value="edit",b();var e=JSON.parse(a.params.roleSettings);u.id=e.id,u.name=e.name,u.cht_name=e.cht_name,u.description=e.description,d.roleHasRanges=[],e.ranges.forEach((function(e){e.sub_ranges.forEach((function(e){d.roleHasRanges.push(e.id)}))}))}else n.push("/admin/permission/roles")})),Object(E["a"])(Object(E["a"])({state:l,roleData:u,fullPage:r,isLoading:o},Object(c["G"])(d)),{},{CheckAllRoles:m,createRole:O,updateRole:f})}};J.render=H;t["default"]=J}}]);
//# sourceMappingURL=chunk-2d0e28d2.57254578.js.map