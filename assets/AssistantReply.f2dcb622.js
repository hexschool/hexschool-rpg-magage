import{r as h,s as G,o as j,a as l,c as n,b as t,G as Q,h as g,p as B,w as D,v as L,Q as Z,F as $,q as F,a6 as nt,C as it,B as H,e as J,f as K,a9 as rt,M as W,g as Y,D as dt,m as ct,X as ut,A as V,Z as T,x as C,T as pt}from"./index.130d352d.js";import{a as mt}from"./statistics.c6f92bea.js";import{a as vt}from"./assistant.fec5cb3b.js";import{b as X}from"./date.204675eb.js";const _t={class:"accordion mb-3",id:"accordionPanelsStayOpenExample"},yt={class:"accordion-item"},ft=t("h2",{class:"accordion-header"},[t("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#panelsStayOpen-collapseOne","aria-expanded":"true","aria-controls":"panelsStayOpen-collapseOne"}," \u67E5\u8A62 ")],-1),ht={id:"panelsStayOpen-collapseOne",class:"accordion-collapse collapse show"},bt={class:"accordion-body"},kt={class:"col-md-12"},$t={key:0},gt={class:"col-md-6"},wt=t("label",{for:"start-time",class:"form-label"},"\u958B\u59CB\u6642\u9593",-1),Ut={class:"col-md-6"},It=t("label",{for:"end-time",class:"form-label"},"\u7D50\u675F\u6642\u9593",-1),xt={class:"my-3"},Ft=t("label",{for:"end-time",class:"form-label"},"\u67E5\u8A62\u985E\u578B",-1),Dt=t("option",{value:"/v1/stats/assistant/total"},"\u7E3D\u9AD4\u6578\u64DA",-1),Mt=t("option",{value:"/v1/stats/assistant/id"},"\u55AE\u4F4D\u52A9\u6559\u7684\u56DE\u8986\u72C0\u6CC1",-1),Ct=[Dt,Mt],St={class:"my-3"},At={class:""},Ot=t("p",{class:"mb-2"},"\u52A9\u6559\u540D\u7A31",-1),qt={class:"list list-unstyled overflow-scroll",style:{height:"200px"}},Lt={class:"form-check"},jt=["id","value"],Rt=["id","value"],Pt=["for"],Vt={class:"d-flex justify-content-between"},Tt=t("button",{type:"submit",class:"btn btn-primary"},"\u67E5\u8A62",-1),Bt={__name:"AssistantSelector",props:{status:{type:String},id:{type:String},data:{type:Object,default(){return{assistantList:[],type:[],range:[]}}},queryParams:{type:Object,default(){return{}}},downloadCSV:{type:Function},openFavoriteModal:{type:Function}},emits:["submit"],setup(S,{emit:A}){const v=S,s=h({assistantUserIds:[],route:"",from:"",to:""});G(()=>v.queryParams,_=>{var e;_.route==="/v1/stats/assistant/id"?s.value.assistantUserIds=((e=_.assistantUserIds)==null?void 0:e[0])||"":s.value.assistantUserIds=_.assistantUserIds||[],s.value.route=_.route,s.value.from=_.from,s.value.to=_.to}),j(()=>{s.value={assistantUserIds:v.queryParams.assistantUserIds||[],route:v.queryParams.route||"/v1/stats/assistant/total",from:v.queryParams.from||"",to:v.queryParams.to||""}});const w=_=>A("submit",_);return(_,e)=>(l(),n("div",_t,[t("div",yt,[ft,t("div",ht,[t("div",bt,[t("form",{class:"row",onSubmit:e[7]||(e[7]=Q(()=>w(s.value),["prevent"]))},[t("div",kt,[s.value.name?(l(),n("h6",$t,"\u76EE\u524D\u6B63\u5728\u5957\u7528\uFF1A"+g(s.value.name),1)):B("",!0)]),t("div",gt,[wt,D(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=y=>s.value.from=y),name:"start-time",id:"start-time",class:"form-control"},null,512),[[L,s.value.from]])]),t("div",Ut,[It,D(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=y=>s.value.to=y),name:"end-time",id:"end-time",class:"form-control"},null,512),[[L,s.value.to]])]),t("div",xt,[Ft,D(t("select",{"onUpdate:modelValue":e[2]||(e[2]=y=>s.value.route=y),class:"form-select","aria-label":"Default select example",onChange:e[3]||(e[3]=()=>s.value.assistantUserIds=[])},Ct,544),[[Z,s.value.route]])]),t("div",St,[t("div",At,[Ot,t("ul",qt,[(l(!0),n($,null,F(v.data.assistantList,({id:y,name:U})=>(l(),n("li",{class:"border border-2 rounded-3 p-2 mb-2",key:y},[t("div",Lt,[s.value.route==="/v1/stats/assistant/id"?D((l(),n("input",{key:0,"onUpdate:modelValue":e[4]||(e[4]=k=>s.value.assistantUserIds=k),id:y,type:"radio",class:"form-check-input",name:"assistantUserIds",value:y},null,8,jt)),[[nt,s.value.assistantUserIds]]):D((l(),n("input",{key:1,"onUpdate:modelValue":e[5]||(e[5]=k=>s.value.assistantUserIds=k),id:y,type:"checkbox",class:"form-check-input",name:"assistantUserIds",value:y},null,8,Rt)),[[it,s.value.assistantUserIds]]),t("label",{for:y,class:"form-check-label"},g(U),9,Pt)])]))),128))])])]),t("div",Vt,[t("button",{onClick:e[6]||(e[6]=()=>v.openFavoriteModal(s.value)),type:"button",class:"btn btn-outline-primary"}," \u5E38\u7528\u8A2D\u5B9A "),Tt])],32)])])])]))}},Gt={class:"row"},Nt={class:"col-md-6"},Et=t("h5",{class:"text-dark mb-3 fw-bold"},"\u5132\u5B58\u70BA\u5E38\u7528\u8A2D\u5B9A",-1),zt={class:"mb-3"},Xt=t("label",{for:"name"},"\u5E38\u7528\u67E5\u8A62\u540D\u7A31",-1),Qt={class:"border border-1 p-3 rounded-3"},Zt=t("p",{class:"mb-2"}," \u52A9\u6559\u540D\u7A31 ",-1),Ht={class:"list list-unstyled overflow-scroll",style:{height:"150px"}},Jt={class:"form-check"},Kt=["id","type","value","checked"],Wt=["for"],Yt={class:"mb-3 mt-2"},ts=t("label",{for:"end-time",class:"form-label"},"\u67E5\u8A62\u985E\u578B",-1),ss=t("option",{value:"/v1/stats/assistant/total"},"\u7E3D\u9AD4\u6578\u64DA",-1),es=t("option",{value:"/v1/stats/assistant/id"},"\u55AE\u4F4D\u52A9\u6559\u7684\u56DE\u8986\u72C0\u6CC1",-1),as=[ss,es],os={class:"mb-3"},ls=t("label",{for:"form"},"\u8D77\u59CB\u65E5\u671F",-1),ns={class:"mb-3"},is=t("label",{for:"to"},"\u7D50\u675F\u65E5\u671F",-1),rs=t("div",{class:"d-flex justify-content-end"},[t("button",{type:"submit",class:"btn btn-outline-primary"},"\u5132\u5B58")],-1),ds={class:"col-md-6"},cs=t("h5",{class:"text-dark mb-3 fw-bold"},"\u5957\u7528\u5E38\u7528\u8A2D\u5B9A",-1),us={class:"list-group list-group-flush"},ps=["onClick"],ms=["onClick","id"],vs=["for"],_s=t("div",{class:"d-flex justify-content-end"},[t("button",{type:"button",class:"btn btn-primary me-2","data-bs-dismiss":"modal"}," \u95DC\u9589 ")],-1),ys={__name:"AssistantFavoriteModal",props:{status:{type:String},data:{type:Object,default(){return{list:[],type:[],range:[]}}},favoriteList:{type:Array,default(){return[]}},options:{type:Object,default(){return{}}}},emits:["applyFavorite","saveFavorite","deleteFavorite"],setup(S,{expose:A,emit:v}){const s=S,w=h(null),_=h(null),e=h({route:s.options.route||"",assistantUserIds:s.options.assistantUserIds||[],from:s.options.from||"",to:s.options.to||""});G(()=>s.options,f=>{e.value=f});const y=()=>{_.value.show()},U=()=>{_.value.hide()};j(()=>{_.value=new H(w.value.hModal)});const k=f=>{v("saveFavorite",f)},b=(f,c)=>{v("applyFavorite",{...c,name:f})},M=f=>{v("deleteFavorite",f)};return A({show:y,hide:U}),(f,c)=>(l(),J(W,{ref_key:"modalRef",ref:w,modalSize:"modal-xl","has-footer":!0},{body:K(()=>[t("div",Gt,[t("div",Nt,[Et,t("form",{onSubmit:c[5]||(c[5]=Q(()=>k(e.value),["prevent"]))},[t("div",zt,[Xt,D(t("input",{"onUpdate:modelValue":c[0]||(c[0]=u=>e.value.name=u),type:"text",class:"form-control",id:"name",placeholder:"\u8ACB\u8F38\u5165\u540D\u7A31"},null,512),[[L,e.value.name]])]),t("div",Qt,[Zt,t("ul",Ht,[(l(!0),n($,null,F(s.data.assistantList,({id:u,name:I})=>(l(),n("li",{class:"border border-2 rounded-3 p-2 mb-2",key:u},[t("div",Jt,[D(t("input",{"onUpdate:modelValue":c[1]||(c[1]=O=>e.value.assistantUserIds=O),id:u,type:S.options.route==="/v1/stats/assistant/id"?"radio":"checkbox",class:"form-check-input",name:"assistantUserIds",value:u,checked:s.options.assistantUserIds.includes(u)},null,8,Kt),[[rt,e.value.assistantUserIds]]),t("label",{for:u,class:"form-check-label"},g(I),9,Wt)])]))),128))])]),t("div",Yt,[ts,D(t("select",{"onUpdate:modelValue":c[2]||(c[2]=u=>e.value.route=u),class:"form-select","aria-label":"Default select example"},as,512),[[Z,e.value.route]])]),t("div",os,[ls,D(t("input",{"onUpdate:modelValue":c[3]||(c[3]=u=>e.value.from=u),type:"date",class:"form-control",id:"form"},null,512),[[L,e.value.from]])]),t("div",ns,[is,D(t("input",{"onUpdate:modelValue":c[4]||(c[4]=u=>e.value.to=u),type:"date",class:"form-control",id:"to"},null,512),[[L,e.value.to]])]),rs],32)]),t("div",ds,[cs,t("ul",us,[(l(!0),n($,null,F(s.favoriteList,({id:u,name:I,route:O,query_params:R})=>(l(),n("li",{class:"list-group-item d-flex align-items-center",key:u},[t("button",{onClick:()=>M(u),type:"button",class:"btn btn-outline-danger btn-sm me-2"},"X",8,ps),t("input",{onClick:()=>b(I,{...R,route:O}),class:"form-check-input me-1",type:"radio",name:"listGroupRadio",id:`firstRadio-${u}`},null,8,ms),t("label",{class:"form-check-label",for:`firstRadio-${u}`},g(I),9,vs)]))),128))])])]),_s]),_:1},512))}},fs={class:"list-group"},hs={class:"badge text-bg-primary rounded-pill"},bs={__name:"AssistantDetailModal",props:{replayDetail:{type:Object,default:()=>({})}},setup(S,{expose:A}){const v=S,s=h(null),w=h(null),_=()=>{w.value.show()},e=()=>{w.value.hide()};return j(()=>{w.value=new H(s.value.hModal)}),A({show:_,hide:e}),(y,U)=>{var k,b;return l(),J(W,{ref_key:"modalRef",ref:s,modalSize:"modal-md","has-footer":!0,title:`${(k=v.replayDetail)==null?void 0:k.date}\uFF5C${(b=v.replayDetail)==null?void 0:b.type}`||""},{body:K(()=>{var M,f;return[t("ul",fs,[(l(!0),n($,null,F((f=v.replayDetail)==null?void 0:f[(M=v.replayDetail)==null?void 0:M.typeName],c=>(l(),n("li",{key:c.id,class:"list-group-item d-flex justify-content-between align-items-center"},[Y(g(c.name)+" ",1),t("span",hs,g(c.count),1)]))),128))])]}),_:1},8,["title"])}}},ks={class:"container-fluid px-4 pt-4 pb-6"},$s=t("h1",{class:"fs-4 mb-5"},"\u52A9\u6559\u56DE\u8986\u91CF",-1),gs={key:0,class:"table-responsive"},ws={class:"table table-striped"},Us={key:0},Is={key:1,class:"table-responsive"},xs={key:0,class:"table table-striped"},Fs=t("th",{style:{"white-space":"nowrap"}},"\u65E5\u671F",-1),Ds={style:{"white-space":"nowrap"}},Ms={key:0,class:"text-muted"},Cs=["onClick"],Ss={key:2},Rs={__name:"AssistantReply",setup(S){const{apiGetAssistantTotal:A,apiGetOneAssistant:v,apiGetAssistantFavorite:s,apiPostAssistantFavorite:w,apiDeleteAssistantFavorite:_,apiGetOneAssistantDetail:e}=mt,{apiGetAssistantList:y}=vt,U=dt.useLoading(),k=ct({list:[],type:[],range:[]}),b=h({route:"/v1/stats/assistant/total",from:X(new Date),to:X(new Date),assistantUserIds:""}),M=h({}),f=h({}),c=h(null),u=h([{key:"nickname",label:"\u52A9\u6559\u540D\u7A31"},{key:"question_count",label:"\u554F\u984C\u56DE\u8986\u6578"},{key:"question_assign_count",label:"\u554F\u984C\u6307\u6D3E\u91CF"},{key:"task_count",label:"\u4EFB\u52D9\u56DE\u8986\u91CF"},{key:"task_assign_count",label:"\u4EFB\u52D9\u6307\u6D3E\u91CF"},{key:"question_completion_rate",label:"\u554F\u984C\u56DE\u8986\u7387"},{key:"task_completion_rate",label:"\u4EFB\u52D9\u56DE\u8986\u7387"}]),I=h([]),O=()=>{I.value.forEach(p=>p.dispose()),I.value=[],[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(p=>{const d=new pt(p);I.value.push(d)})};G(()=>M.value,async()=>{await T(),O()}),ut(()=>{I.value.forEach(r=>r.dispose()),I.value=[]});const R=async r=>{var d,m,i,a;const p=U.show();b.value.route=r.route;try{if(r.route==="/v1/stats/assistant/total"){const{result:o}=await A({from:r.from,to:r.to,assistantUserIds:r.assistantUserIds.join(",")});M.value=(o==null?void 0:o.stats)||[]}else{const{result:o}=await v({from:r.from,to:r.to,assistantUserIds:r.assistantUserIds});f.value=o}await T(),O()}catch(o){console.log(o),C("danger","\u67E5\u8A62\u5931\u6557",`${(m=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:m.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{p.hide()}},N=h([]),P=async()=>{var p,d,m,i;const r=U.show();try{const{result:a}=await s();N.value=a}catch(a){C("danger","\u53D6\u5F97\u5931\u6557",`${(d=(p=a==null?void 0:a.response)==null?void 0:p.data)==null?void 0:d.statusCode}:${(i=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:i.message}`)}finally{r.hide()}},tt=r=>{b.value=r,c.value.show()},st=async r=>{var d,m,i,a;const p=U.show();try{await w({...r,assistantUserIds:r.assistantUserIds.join(",")}),C("success","\u5132\u5B58\u6210\u529F","\u5DF2\u6210\u529F\u5132\u5B58\u5E38\u7528\u8A2D\u5B9A"),await P()}catch(o){C("danger","\u5132\u5B58\u5931\u6557",`${(m=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:m.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{p.hide()}},et=async r=>{b.value={...r,assistantUserIds:r.assistantUserIds.split(",").map(p=>p)},c.value.hide()},at=async r=>{var d,m,i,a;const p=U.show();try{await _(r),C("success","\u522A\u9664\u6210\u529F","\u5DF2\u6210\u529F\u522A\u9664\u5E38\u7528\u8A2D\u5B9A"),await P()}catch(o){C("danger","\u522A\u9664\u5931\u6557",`${(m=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:m.statusCode}:${(a=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:a.message}`)}finally{p.hide()}};j(async()=>{var p,d,m,i;const r=U.show();try{const{assistants:a}=await y();k.assistantList=a.map(o=>({id:o.user_id,name:o.nickname})),await P(),await T(),O()}catch(a){C("danger","\u5931\u6557",`${(d=(p=a==null?void 0:a.response)==null?void 0:p.data)==null?void 0:d.statusCode}:${(i=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:i.message}`)}finally{r.hide()}});const E=h(null),z=h({}),ot=async(r,p,d)=>{var i,a,o,q;r.preventDefault();const m={\u554F\u7B54\u6578\u91CF:"question",\u4EFB\u52D9\u6578\u91CF:"task"};try{const{result:x}=await e({date:p,assistantId:b.value.assistantUserIds[0],type:m[d]});E.value.show(),z.value={...x,type:d,typeName:`${m[d]}s`}}catch(x){C("danger","\u5931\u6557",`${(a=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:a.statusCode}:${(q=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:q.message}`)}};return(r,p)=>{var d,m;return l(),n($,null,[t("div",ks,[$s,V(Bt,{id:M.value.id,data:k,onSubmit:R,openFavoriteModal:tt,queryParams:b.value},null,8,["id","data","queryParams"]),b.value.route==="/v1/stats/assistant/total"?(l(),n("div",gs,[t("table",ws,[t("thead",null,[t("tr",null,[(l(!0),n($,null,F(u.value,i=>(l(),n("th",{key:i.key,style:{"white-space":"nowrap"}},g(i.label),1))),128))])]),t("tbody",null,[(l(!0),n($,null,F(M.value,i=>(l(),n("tr",{key:i.nickname},[(l(!0),n($,null,F(u.value,a=>(l(),n("td",{key:a.key,style:{"white-space":"nowrap"}},[Y(g(i[a.key])+" ",1),a.key.includes("rate")?(l(),n("span",Us,"%")):B("",!0)]))),128))]))),128))])])])):b.value.route==="/v1/stats/assistant/id"?(l(),n("div",Is,[f.value.nickname?(l(),n("table",xs,[t("thead",null,[t("tr",null,[Fs,(l(!0),n($,null,F(Object.values((d=f.value)==null?void 0:d.stats),i=>(l(),n("th",{key:i.cht_name,style:{"white-space":"nowrap"}},g(i.cht_name),1))),128))])]),t("tbody",null,[(l(!0),n($,null,F((m=f.value)==null?void 0:m.date,(i,a)=>{var o;return l(),n("tr",{key:i},[t("td",Ds,g(i),1),(l(!0),n($,null,F(Object.values((o=f.value)==null?void 0:o.stats),(q,x)=>(l(),n("td",{key:`\u554F\u7B54_${x}`,style:{"white-space":"nowrap"}},[q.data[a].toString()==="0"?(l(),n("span",Ms,"0")):(l(),n("a",{key:1,"data-bs-toggle":"tooltip",title:"\u9EDE\u64CA\u67E5\u770B\u56DE\u8986\u7D30\u7BC0",class:"text-decoration-none",href:"#",onClick:lt=>{ot(lt,i,q.cht_name)}},g(q.data[a]),9,Cs))]))),128))])}),128))])])):B("",!0)])):(l(),n("div",Ss))]),V(bs,{ref_key:"AssistantDetailModalRef",ref:E,replayDetail:z.value},null,8,["replayDetail"]),V(ys,{ref_key:"FavoriteModalRef",ref:c,data:k,options:b.value,favoriteList:N.value,onSaveFavorite:st,onApplyFavorite:et,onDeleteFavorite:at},null,8,["data","options","favoriteList"])],64)}}};export{Rs as default};
